// Generated by CoffeeScript 1.8.0
(function() {
  'use strict';
  angular.module('projectApp').controller('jouwEnergieCtrl', function($scope, $http, Auth) {
    var dates, getLabelsForGraph, getValuesForGraph, loadGraph, names, userId, values;
    dates = [];
    values = [];
    names = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
    userId = Auth.getCurrentUser()._id;
    $http.get('/api/extradata/' + userId).then(function(userdata) {
      $scope.userdata = userdata;
      if ($scope.userdata.data === '' || $scope.userdata.data === null) {
        return $scope.customError = "no-userdata";
      } else {
        return $http.get('/api/electricityvalue/' + userId).then(function(elecValues) {
          $scope.elecValues = elecValues;
          if ($scope.elecValues.data === '' || $scope.elecValues.data === null || Object.getOwnPropertyNames($scope.elecValues.data).length === 1) {
            return $scope.customError = "no-elecData";
          } else {
            getLabelsForGraph(dates);
            getValuesForGraph(dates);
            return loadGraph(dates, values);
          }
        });
      }
    });
    getLabelsForGraph = function(dates) {
      var date, dateValue, _results;
      date = new Date();
      date.setDate(date.getDate() - 6);
      _results = [];
      while (date <= new Date()) {
        dateValue = names[date.getDay()] + " " + date.getDate() + "/" + (date.getMonth() + 1);
        dates.push(dateValue);
        _results.push(date.setDate(date.getDate() + 1));
      }
      return _results;
    };
    getValuesForGraph = function(dates) {
      var bool, date, dateName, dateOfWeek, elecValue, _i, _j, _len, _len1, _ref, _results;
      _results = [];
      for (_i = 0, _len = dates.length; _i < _len; _i++) {
        dateOfWeek = dates[_i];
        bool = false;
        _ref = $scope.elecValues.data;
        for (_j = 0, _len1 = _ref.length; _j < _len1; _j++) {
          elecValue = _ref[_j];
          date = new Date(elecValue.measureday);
          dateName = names[date.getDay()] + " " + date.getDate() + "/" + (date.getMonth() + 1);
          if (dateName === dateOfWeek) {
            bool = true;
            break;
          }
        }
        if (bool === true) {
          if (elecValue.previousValue === 0) {
            _results.push(values.push('0'));
          } else {
            _results.push(values.push(elecValue.currentValue - elecValue.previousValue));
          }
        } else {
          _results.push(values.push('0'));
        }
      }
      return _results;
    };
    return loadGraph = function(dates, values) {
      return new Chartist.Bar('.ct-chart', {
        labels: dates,
        series: [values]
      }, {
        axisX: {
          showGrid: false
        },
        width: 650,
        height: 500
      });
    };
  });

}).call(this);

//# sourceMappingURL=jouwenergie.controller.js.map

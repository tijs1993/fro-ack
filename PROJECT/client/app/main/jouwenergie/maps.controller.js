// Generated by CoffeeScript 1.8.0
(function() {
  'use strict';
  angular.module('projectApp').controller('mapsCtrl', function($scope, Auth, $location, $http) {
    var api, bounds, getJSONData, i, image, locations, map, mapOptions, showOnMap, userId;
    userId = Auth.getCurrentUser()._id;
    api = "AIzaSyDiPv6sSKzmOR1INjC_9kHxUY6bpwKOXHc";
    map;
    i = 0;
    bounds = new google.maps.LatLngBounds();
    mapOptions = {
      zoom: 10
    };
    image = 'http://maps.google.com/mapfiles/ms/icons/red-dot.png';
    locations = [];
    map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
    $http.get('/api/extradata/').then(function(userdata) {
      var user, _i, _len, _ref, _results;
      $scope.userdata = userdata;
      _ref = $scope.userdata.data;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        user = _ref[_i];
        if (user.accountId === userId) {
          image = 'http://maps.google.com/mapfiles/ms/icons/green-dot.png';
        } else {
          image = 'http://maps.google.com/mapfiles/ms/icons/red-dot.png';
        }
        _results.push(locations.push([user._id, user.address.street, user.address.zipcode, user.address.city, user.address.country]));
      }
      return _results;
    });
    getJSONData = function() {
      var urlForLatAndLong, user, _i, _len, _ref, _results;
      console.log(locations);
      _ref = $scope.userdata.data;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        user = _ref[_i];
        if (user.accountId === userId) {
          image = '/assets/images/markers/letter_h.png';
        } else {
          image = 'http://maps.google.com/mapfiles/ms/icons/red-dot.png';
        }
        urlForLatAndLong = "https://maps.googleapis.com/maps/api/geocode/json?address=" + user.address.street + "+" + user.address.city + "+" + user.address.country + "&key=" + api;
        $.ajax({
          url: urlForLatAndLong,
          dataType: 'json',
          async: false,
          success: function(data) {
            var lat, long;
            lat = data["results"][0]["geometry"]["location"]["lat"];
            long = data["results"][0]["geometry"]["location"]["lng"];
            return showOnMap(lat, long, i);
          }
        });
        _results.push(i++);
      }
      return _results;
    };
    showOnMap = function(lat, long, i) {
      var infoWindow, marker, myLatLng;
      myLatLng = new google.maps.LatLng(lat, long);
      bounds.extend(myLatLng);
      marker = new google.maps.Marker({
        position: myLatLng,
        map: map,
        icon: image
      });
      infoWindow = new google.maps.InfoWindow();
      marker;
      google.maps.event.addListener(marker, 'click', (function(marker, i) {
        return function() {
          var content;
          content = "<div id='content'>" + "<h1>" + locations[i][0] + "</h1>" + "<p><i>" + locations[i][1] + "<br />" + locations[i][2] + " " + locations[i][3] + "</i></p>" + "</div>";
          infoWindow.setContent(content);
          return infoWindow.open(map, marker);
        };
      })(marker, i));
      return map.fitBounds(bounds);
    };
    return google.maps.event.addDomListener(window, 'load', getJSONData);
  });

}).call(this);

//# sourceMappingURL=maps.controller.js.map
